
name: Test Workflow

on:
    push:
        branches:
            - main
        paths:
            - folder/**

env:
    model_dirs: 'folder/'

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: 'read'
      id-token: 'write'
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Get changed files
        id: changes
        run: |
          echo "files=$(git diff --name-only --diff-filter=ACMRT ${{ github.event.base_ref }} ${{ github.sha }} | xargs)" >> $GITHUB_OUTPUT
  
      - name: Determine triggering component dir
        id: determine_dir
        shell: bash
        run: |
          # Show paths
          echo "Paths: ${{ env.model_dirs }}"

          # Get the list of paths being monitored
          monitored_paths=$(echo "${{ env.model_dirs }}" | tr "," " ")
          echo "Monitored paths: $monitored_paths"
          echo "Changed files: ${{ steps.changes.outputs.files }}"
          echo "If you see here files that you have not modified, please update your branch with changes from main."

          # Loop through each path
          for path in $monitored_paths
          do
            # Check if the modified files include this path
            if echo "${{ steps.changes.outputs.files }}" | grep -q "$path"; then
              # Set the output variable and exit the loop
              echo "triggering_path is $path"
              echo "triggering_path=$path" >> $GITHUB_OUTPUT
              break
            fi
          done
    
